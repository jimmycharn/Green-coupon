# รายงานวิเคราะห์โครงสร้างและ Flow การทำงานของระบบ Green Coupon

รายงานนี้รวบรวมรายละเอียดเกี่ยวกับ Flow การทำงานของแต่ละฝ่ายในระบบ (Admin, นักเรียน, จุดขายคูปอง, และร้านค้า) เพื่อความเข้าใจที่ชัดเจนในการใช้งานและดูแลรักษาระบบ

---

## บทที่ 1: ภาพรวมระบบ (System Overview)

ระบบ **Green Coupon** เป็นระบบจัดการคูปองดิจิทัลสำหรับโรงอาหารหรือศูนย์อาหาร โดยเปลี่ยนการใช้คูปองกระดาษหรือเงินสด มาเป็นเครดิตในระบบดิจิทัล เพื่อความสะดวก รวดเร็ว และตรวจสอบได้ง่าย

**ผู้ใช้งานหลัก (Main Actors):**
1. **Admin (ผู้ดูแลระบบ):** จัดการผู้ใช้งานและควบคุมวงเงินในระบบ (Clearing House)
2. **Student (นักเรียน):** ผู้ใช้งานที่เติมเงินและนำไปซื้อสินค้า
3. **Staff (จุดขายคูปอง/เจ้าหน้าที่):** จุดรับแลกเงินสดเปลี่ยนเป็นเครดิต (Top-up) หรือแลกคืน (Refund)
4. **Shop (ร้านค้า):** ผู้รับชำระเงินค่าสินค้าจากนักเรียน

**Flow หลักของระบบ:**
1. **เติมเงิน:** นักเรียนนำเงินสดไปให้ Staff -> Staff เติมเครดิตให้นักเรียน
2. **ซื้อของ:** นักเรียนสแกนจ่ายให้ร้านค้า -> เครดิตโอนจากนักเรียนไปร้านค้า
3. **แลกคืน:** นักเรียนขอถอนเครดิตคืน -> Staff จ่ายเงินสดคืนและตัดเครดิต
4. **เคลียร์เงิน:** Admin เคลียร์เงินกับร้านค้า (จ่ายเงินให้ร้านค้า) และเคลียร์เงินกับ Staff (เก็บเงินสดจากจุดขาย)

---

## บทที่ 2: Admin Workflow (ผู้ดูแลระบบ)

Admin คือหัวใจหลักของระบบในการจัดการบัญชีและตรวจสอบยอดเงินรวม

### หน้าที่และ Flow การทำงาน:
1. **ดูภาพรวม (Dashboard Stats):**
   - ดูยอดเงินรวมของนักเรียน (เงินลอยในระบบ)
   - ดูยอดรอจ่ายร้านค้า (Pending Withdrawals)
   - ดูเงินสดที่อยู่กับจุดขาย (Cash on Hand)
   - ดูยอดเงินคงเหลือของ Admin เอง
  
2. **จัดการผู้ใช้งาน (User Management):**
   - **สร้างผู้ใช้งานใหม่ (Create User):** สร้าง account ให้นักเรียน, ร้านค้า, หรือ Staff
   - **แก้ไขข้อมูล (Edit User):** เปลี่ยนชื่อ, Role, หรือรหัสประจำตัว
   - **Reset Password** (ถ้ามี)

3. **การจัดการเงิน (Cash Management):**
   - **จ่ายเงินให้ร้านค้า (Clear Shop Balance):** 
     - เมื่อร้านค้ามียอดเงินสะสม Admin จะทำการจ่ายเงินจริง (โอน/เงินสด) ให้ร้านค้า 
     - จากนั้นกดปุ่ม **"จ่ายเงินให้" (Pay Shop)** ในระบบเพื่อตัดยอดในแอพให้เป็น 0
   - **เก็บเงินจากจุดขาย (Collect from Staff):**
     - จุดขายคูปองจะมีเงินสด (Cash on Hand) จากการเติมเงินของนักเรียน
     - Admin ไปเก็บเงินสดนั้นมา และกดปุ่ม **"เก็บเงินจาก" (Collect)** ในระบบเพื่อปรับยอด Cash on Hand ของ Staff ให้ลดลง

---

## บทที่ 3: Student Workflow (นักเรียน)

นักเรียนคือผู้ใช้งานปลายทางที่ใช้เครดิตในการซื้ออาหาร

### หน้าที่และ Flow การทำงาน:
1. **การเติมเงิน (Top-up):**
   - เดินไปที่ **จุดขายคูปอง (Staff)**
   - เปิดแอพหน้า Dashboard -> กด **"QR ของฉัน"**
   - ยื่น QR Code ให้ Staff สแกน
   - จ่ายเงินสดให้ Staff
   - เครดิตจะเข้าแอพทันที และมีการแจ้งเตือน (Top-up Notification)

2. **การซื้อสินค้า (Purchase):**
   - สั่งอาหารที่ร้านค้า
   - กดปุ่ม **"สแกนจ่าย"** ในแอพ
   - สแกน QR Code ของร้านค้า
   - **ระบุจำนวนเงิน** ที่ต้องการจ่าย
   - กด "ยืนยัน" -> เงินจะถูกหักจากกระเป๋าและโอนให้ร้านค้าทันที

3. **การแลกเงินคืน (Refund):**
   - หากต้องการแลกเครดิตที่เหลือคืนเป็นเงินสด ให้ไปหา Staff
   - เปิด **"QR ของฉัน"** ให้ Staff สแกน
   - แจ้งจำนวนเงินที่ต้องการแลกคืน
   - รับเงินสดจาก Staff

4. **ดูรายการย้อนหลัง:** ดูประวัติการเติมเงิน, จ่ายเงิน, และแลกคืนได้ที่หน้า Dashboard

---

## บทที่ 4: Coupon Selling Point Workflow (จุดขายคูปอง / Staff)

Staff หรือ "จุดขายคูปอง" ทำหน้าที่เป็นคนกลางเปลี่ยนเงินสดให้เป็นเครดิต และเปลี่ยนเครดิตเป็นเงินสด เหมือนแคชเชียร์แลกคูปอง

### หน้าที่และ Flow การทำงาน:
1. **การเติมเงิน (Top-up):**
   - รับเงินสดจากนักเรียน
   - กดโหมด **"เติมเงิน (+)"**
   - กด **"สแกน QR นักเรียน"** หรือค้นหาจากรายชื่อ
   - ใส่จำนวนเงินที่รับมา
   - กดยืนยัน -> ระบบโอนเครดิตให้นักเรียน, และเพิ่มยอด **"เงินสดที่จุดขาย" (Cash on Hand)** ของ Staff

2. **การคืนเงิน (Refund):**
   - นักเรียนมาขอคืนเงิน
   - กดโหมด **"คืนเงิน (-)"**
   - สแกน QR นักเรียน
   - ใส่จำนวนเงินที่คืน
   - กดยืนยัน -> ระบบตัดเครดิตนักเรียน, และลดยอด **"เงินสดที่จุดขาย"** ของ Staff

3. **การส่งเงินให้ Admin:**
   - เมื่อเงินสดในมือกองเยอะ Staff ไม่ต้องทำอะไรในแอพ
   - รอ Admin มาเก็บเงินสด และ Admin จะเป็นคนกดตัดยอด Cash on Hand ในระบบให้เอง

---

## บทที่ 5: Shop Workflow (ร้านค้า)

ร้านค้ามีหน้าที่รับชำระเงินอย่างเดียว ไม่มีการโอนเงินออกเอง

### หน้าที่และ Flow การทำงาน:
1. **รับชำระเงิน:**
   - ร้านค้าเปิดหน้า Dashboard จะเห็น **QR รับเงิน** (สามารถขยายใหญ่ให้ลูกค้าสแกนได้)
   - เมื่อนักเรียนสแกนจ่าย ร้านค้าจะได้รับ **การแจ้งเตือน (Realtime Notification)** ทันทีว่าได้รับเงินเท่าไหร่ จากใคร
   - ยอดเงิน **"รอจ่ายร้านค้า"** จะเพิ่มขึ้น

2. **ดูรายการขาย:**
   - ดูประวัติการรับเงินย้อนหลังได้ในหน้า Dashboard (รายการขาย) โดยจะเห็นชื่อลูกค้า เวลา และจำนวนเงิน

3. **การถอนเงิน (Withdrawal):**
   - ร้านค้าสะสมยอดขายไว้
   - เมื่อถึงรอบเคลียร์เงิน Admin จะนำเงินมาจ่ายให้ร้านค้า
   - ยอดในแอพจะถูก Admin ตัดออกหลังจากจ่ายเงินแล้ว ร้านค้าทำหน้าที่แค่ตรวจสอบว่าได้รับเงินจริงตรงกับยอดในแอพหรือไม่

---
*Generated by AI Assistant based on Codebase Analysis*
